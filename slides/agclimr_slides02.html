<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content=" December 2, 2022 https://ucanr-igis.github.io/agroclimR/ " />
  <meta name="copyright" content="<a href='https://ucanr-igis.github.io/agroclimR/' style='color:#444;'>https://ucanr-igis.github.io/agroclimR/</a>"/>
  <title>Agroclimate Metrics Pt2</title>
  <style type="text/css">
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
            pre > code.sourceCode { white-space: pre; position: relative; }
            pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
            pre > code.sourceCode > span:empty { height: 1.2em; }
            .sourceCode { overflow: visible; }
            code.sourceCode > span { color: inherit; text-decoration: inherit; }
            div.sourceCode { margin: 1em 0; }
            pre.sourceCode { margin: 0; }
            @media screen {
            div.sourceCode { overflow: auto; }
            }
            @media print {
            pre > code.sourceCode { white-space: pre-wrap; }
            pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
            }
            pre.numberSource code
              { counter-reset: source-line 0; }
            pre.numberSource code > span
              { position: relative; left: -4em; counter-increment: source-line; }
            pre.numberSource code > span > a:first-child::before
              { content: counter(source-line);
                position: relative; left: -1em; text-align: right; vertical-align: baseline;
                border: none; display: inline-block;
                -webkit-touch-callout: none; -webkit-user-select: none;
                -khtml-user-select: none; -moz-user-select: none;
                -ms-user-select: none; user-select: none;
                padding: 0 4px; width: 4em;
                color: #aaaaaa;
              }
            pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
            div.sourceCode
              {   }
            @media screen {
            pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
            }
            code span.al { color: #ff0000; font-weight: bold; } /* Alert */
            code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
            code span.at { color: #7d9029; } /* Attribute */
            code span.bn { color: #40a070; } /* BaseN */
            code span.bu { color: #008000; } /* BuiltIn */
            code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
            code span.ch { color: #4070a0; } /* Char */
            code span.cn { color: #880000; } /* Constant */
            code span.co { color: #60a0b0; font-style: italic; } /* Comment */
            code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
            code span.do { color: #ba2121; font-style: italic; } /* Documentation */
            code span.dt { color: #902000; } /* DataType */
            code span.dv { color: #40a070; } /* DecVal */
            code span.er { color: #ff0000; font-weight: bold; } /* Error */
            code span.ex { } /* Extension */
            code span.fl { color: #40a070; } /* Float */
            code span.fu { color: #06287e; } /* Function */
            code span.im { color: #008000; font-weight: bold; } /* Import */
            code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
            code span.kw { color: #007020; font-weight: bold; } /* Keyword */
            code span.op { color: #666666; } /* Operator */
            code span.ot { color: #007020; } /* Other */
            code span.pp { color: #bc7a00; } /* Preprocessor */
            code span.sc { color: #4070a0; } /* SpecialChar */
            code span.ss { color: #bb6688; } /* SpecialString */
            code span.st { color: #4070a0; } /* String */
            code span.va { color: #19177c; } /* Variable */
            code span.vs { color: #4070a0; } /* VerbatimString */
            code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
          </style>
  <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="icon" type="image/png" sizes="32x32" href="./images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./images/favicon-16x16.png">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">

  <script language="javascript" type="text/javascript">w3c_slidy.mouse_click_enabled = false;</script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-41HMZ3JJJ6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-41HMZ3JJJ6');
  </script>
  <script src="lib/header-attrs-2.17/header-attrs.js"></script>
  <link href="lib/slidy-2/styles/slidy.css" rel="stylesheet" />
  <script src="lib/slidy-2/scripts/slidy.js"></script>
  <script src="lib/slidy_shiny-1/slidy_shiny.js"></script>
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
   href="slidy2022.css" />
</head>
<body>
<div class="slide titlepage">
  <h1 class="title">Computing Agroclimate Metrics in R</h1>
  <h1 class="subtitle">Part II. Cummulative Metrics and Multi-Year
Summaries</h1>
  <p class="author">
<img src='images/tomato-growth-sun_640x286x256.png' style='width:640px; height:286px; margin-top:0.5em; margin-bottom:1em;'/><br/>December
2,
2022<br/><a href='https://ucanr-igis.github.io/agroclimR/' style='color:darkgreen; font-size:105%; font-family:monospace;'>https://ucanr-igis.github.io/agroclimR/
</a>
  </p>
  <p class="date"><a ref='https://igis.ucanr.edu/'><img src='images/igis-logo_550x58x256.png' style='margin-top:1.5em;'/></a></p>
</div>
<div id="degree-days" class="slide section level1">
<h1>Degree Days</h1>
<script type="text/javascript">
w3c_slidy.mouse_click_enabled = false;
</script>
<div
style="display:flex; justify-content:start; align-items:start; margin-left:2em;">
<div style="flex-shrink:1;">
The growth rate of plants and insects is influenced by temperature.
<div class="indented1">
<ul>
<li>poikilothermic = internal temperature varies considerably<br />
</li>
<li>temperatures need to be above a certain threshold to develop<br />
</li>
<li>development also stops if it gets too hot</li>
</ul>
</div>
</div>
<div style="flex-shrink:1;">
<p><img src="images/brown-stink-bug_330x240_q10.jpg" /></p>
</div>
</div>
<p><!-- flex div container --></p>
<div
style="display:flex; justify-content:start; align-items:start; margin-left:2em;">
<div style="flex-shrink:1; max-width:600px;">
Phenology events occur require a net sum amount of development to take
place.
<div class="indented1">
<ul>
<li>blooming<br />
</li>
<li>hull splitting</li>
<li>egg laying<br />
</li>
</ul>
</div>
<p>The timing of phenology events can be correlated with <em>the sum
amount of warmth within an organism’s usable range of temperature over a
period of time</em></p>
</div>
<div style="flex-shrink:1;">
<p><img
src="images/collards-seed-packet_highlight-red_260x380.jpg" /></p>
</div>
</div>
<p><!-- flex div container --></p>
</div>
<div id="computing-degree-days-from-the-daily-min-max-temp"
class="slide section level1">
<h1>Computing Degree Days from the Daily Min &amp; Max Temp</h1>
<h2
id="how-do-you-mathematically-model-temperature-over-the-course-of-the-day">1)
How do you mathematically model temperature over the course of the
day?</h2>
<p>Researchers have explored several options:</p>
<div class="centerme">
<p><img src="images/zalom83_fig04_350x670x256.png" /><br />
Zalom et al (<a href="https://catalog.hathitrust.org/Record/008707238"
target="_blank" rel="noopener">1983</a>)</p>
</div>
<p><br />
</p>
<h2
id="how-you-do-you-find-the-area-under-the-curve-that-falls-within-the-range-of-usuable-temperatures-for-a-given-species">2)
How you do you find the area under the curve, that falls within the
range of usuable temperatures for a given species?</h2>
<p><br />
</p>
<div style="display:flex; justify-content:center; align-items:center;">
<div style="flex-shrink:1;">
<p><img src="images/zalom83_tbl5_730x850x256.png" /><br/> Zalom et al
(<a href="https://catalog.hathitrust.org/Record/008707238"
target="_blank" rel="noopener">1983</a>)</p>
</div>
<div style="flex-shrink:1;">
<p><img src="images/smiley_stunned_120x120.png" /></p>
</div>
</div>
<p><!-- flex div container --></p>
<div class="centerme">
<p><a href="https://ucanr-igis.github.io/degday/" target="_blank"
rel="noopener"><img
src="images/degday_hexlogo_v1a_173x200.png" /></a></p>
</div>
<p><br />
</p>
</div>
<div id="phenology-tables" class="slide section level1">
<h1>Phenology Tables</h1>
<p>Degree days are not very useful by themselves. You need to use them
with a <em>phenology table</em> that predicts when events will take
place based on accumulated degree days.</p>
<p>Phenology tables also tell you <em>when to start counting</em> degree
days (i.e. <em>biofix</em>).</p>
<p>The biofix could be a calendar date, or the date of an observation
such as when you see eggs in your traps.</p>
<p><br />
</p>
</div>
<div id="chill-hours-chill-portions" class="slide section level1">
<h1>Chill Hours &amp; Chill Portions</h1>
<div style="display:flex; justify-content:center; align-items:start;">
<div style="flex-shrink:1; max-width:700px;">
<div class="indented1">
<ul>
<li>Chill hours and portions measure the accumulated cold over
time.</li>
<li>Many fruit and nut trees have developed an internal mechanism to
keep track of accumulated cold during the winter.</li>
<li>This tells them when its safe to ‘wake up’ from their winter
dormancy, and not get nailed by a late frost.</li>
<li>Chill Hours are the number of hours where the temperature was ≥ 0 °C
and ≤ 7.2 °C.</li>
<li>Chill Portions are more complicated, but do a better job of
predicting spring bloom.</li>
</ul>
</div>
</div>
<div style="flex-shrink:1;">
<p><img src="images/winter-orchard_450x338_q10.jpg" /></p>
</div>
</div>
<p><!-- flex div container --></p>
<p><br />
</p>
<div class="centerme">
<p><a href="https://cran.r-project.org/package=chillR/" target="_blank"
rel="noopener"><img src="images/chillr_hex_173x200x256.png" /></a></p>
<p>For a deeper dive into chill, see the e-book:<br/> <a
href="http://inresgb-lehre.iaas.uni-bonn.de/chillR_book/introduction.html"
target="_blank" rel="noopener"><strong>Tree Phenology Analysis with
R</strong></a><br/> by Eike Luedeling</p>
</div>
<p><br />
</p>
</div>
<div id="r-tricks-date-parts" class="slide section level1">
<h1>R-tricks: Date Parts</h1>
<p>Analyzing multi-year data often requires using <em>date parts</em>
(e.g., month, year, Julian day), for filtering and grouping.</p>
<p>The <code>lubridate</code> package has functions you can use to
define date parts. Examples:</p>
<div class="indented2 indented2r">
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>(x <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-09-05&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;2022-09-05&quot;</code></pre>
</div>
<p><br />
</p>
<div class="indented2 indented2r">
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">day</span>(x)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">month</span>(x)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">year</span>(x)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">yday</span>(x)  <span class="do">## &#39;Julian&#39; date</span></span></code></pre></div>
<pre><code>## [1] 5
## [1] 9
## [1] 2022
## [1] 248</code></pre>
</div>
<p><br />
</p>
</div>
<div id="r-tricks-converting-units" class="slide section level1">
<h1>R-tricks: Converting Units</h1>
<p>Weather data often requires you to convert units.</p>
<p>The <code>units</code> package comes with a database of conversion
constants so you don’t have to look them up.</p>
<p>Many R packages (including API clients) are returning values as
‘units’ objects (numeric values with units attached).</p>
<p>Example:</p>
<div class="indented2 indented2r">
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(units)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>boiling_int <span class="ot">&lt;-</span> <span class="dv">212</span>                            <span class="do">## plain number</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>boiling_f <span class="ot">&lt;-</span> <span class="fu">set_units</span>(boiling_int, degF)     <span class="do">## a &#39;units&#39; object</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>boiling_f</span></code></pre></div>
<pre><code>## 212 [degF]</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>boiling_c <span class="ot">&lt;-</span> <span class="fu">set_units</span>(boiling_f, degC)       <span class="do">## convert to degrees Celsius by setting different units</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>boiling_c</span></code></pre></div>
<pre><code>## 100 [°C]</code></pre>
</div>
<p><br />
</p>
</div>
<div id="r-tricks-grouping-rows-of-data" class="slide section level1">
<h1>R-tricks: Grouping Rows of Data</h1>
<style type="text/css">
p.centerpiece {
  text-align:center;
  font-size:120%;
  font-weight:bold;
  font-family:monospace;
}
</style>
<p>For multi-year or multi-site data, you often need to work with
<em>groups of rows</em>.</p>
<p>To work with groups in <code>dplyr</code>, we add functions that:</p>
<div class="indented1 li-single">
<ol style="list-style-type: decimal">
<li>define the groups</li>
<li>do something with those groups</li>
</ol>
</div>
<p><br />
</p>
<h2 id="define-groups">1. Define groups</h2>
<p class="centerpiece">
group_by()
</p>
<p>The argument(s) to <code>group_by()</code> should be column(s) or
expression(s) that defines the row groups.</p>
<p>Each unique value will become a group of rows.</p>
<p><strong>Example:</strong></p>
<div class="indented2 indented2r">
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>storms <span class="sc">|&gt;</span>  </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span>    <span class="do">## group the rows by year</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
## # Groups:   year [1]
##   name   year month   day  hour   lat  long status categ…¹  wind press…² tropi…³
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;ord&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;
## 1 Amy    1975     6    27     0  27.5 -79   tropi… -1         25    1013      NA
## 2 Amy    1975     6    27     6  28.5 -79   tropi… -1         25    1013      NA
## 3 Amy    1975     6    27    12  29.5 -79   tropi… -1         25    1013      NA
## 4 Amy    1975     6    27    18  30.5 -79   tropi… -1         25    1013      NA
## 5 Amy    1975     6    28     0  31.5 -78.8 tropi… -1         25    1012      NA
## 6 Amy    1975     6    28     6  32.4 -78.7 tropi… -1         25    1012      NA
## # … with 1 more variable: hurricane_force_diameter &lt;int&gt;, and abbreviated
## #   variable names ¹​category, ²​pressure, ³​tropicalstorm_force_diameter</code></pre>
</div>
<p>Note - nothing looks different! This is because the groups are
defined <em>invisibly</em>.</p>
<p>To do something productive with the groups, we have to add something
else…</p>
<p><br />
</p>
<h2 id="a.-compute-metrics-for-each-group-separately">2a. Compute
Metrics for Each Group Separately</h2>
<p class="centerpiece">
group_by() + mutate()
</p>
<p>When working with cumulative metrics (i.e., chill portions) for
multiple years of data, you may want to calculate the metric for groups
of rows. You can compute metrics for groups of rows by following
<code>group_by()</code> with <code>mutate()</code>.</p>
<p><strong>Example:</strong></p>
<p>We make a fake time series dataset consisting of a random number 0-10
each day for a year:</p>
<div class="indented2 indented2r">
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>val_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">dt =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2010-01-01&quot;</span>), </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2010-06-30&quot;</span>),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">val =</span> <span class="fu">runif</span>(<span class="fu">n</span>(), <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">10</span>))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>val_tbl <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   dt           val
##   &lt;date&gt;     &lt;dbl&gt;
## 1 2010-01-01  1.15
## 2 2010-01-02  4.58
## 3 2010-01-03  4.46
## 4 2010-01-04  5.44
## 5 2010-01-05  1.10
## 6 2010-01-06  6.11</code></pre>
</div>
<p><br />
</p>
<p>Next we compute the cumulative sum of <code>val</code> for each month
(note how <code>month</code> is computed on-the-fly by
<code>group_by()</code>):</p>
<div class="indented2 indented2r">
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>val_cumsum_bymonth_tbl <span class="ot">&lt;-</span> val_tbl <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">month =</span> lubridate<span class="sc">::</span><span class="fu">month</span>(dt)) <span class="sc">|&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cumsum_val =</span> <span class="fu">cumsum</span>(val))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>val_cumsum_bymonth_tbl <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
## # Groups:   month [1]
##   dt           val month cumsum_val
##   &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
## 1 2010-01-01  1.15     1       1.15
## 2 2010-01-02  4.58     1       5.73
## 3 2010-01-03  4.46     1      10.2 
## 4 2010-01-04  5.44     1      15.6 
## 5 2010-01-05  1.10     1      16.7 
## 6 2010-01-06  6.11     1      22.8</code></pre>
</div>
<p>Plot it to see the pattern:</p>
<div class="indented2 indented2r">
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(val_cumsum_bymonth_tbl, <span class="fu">aes</span>(<span class="at">x =</span> dt, <span class="at">y =</span> cumsum_val)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="agclimr_slides02_files/figure-slidy/unnamed-chunk-8-1.png" width="768" /></p>
</div>
<p><br />
</p>
<h2 id="b.-compute-summaries-for-each-group">2b. Compute Summaries for
each Group</h2>
<p class="centerpiece">
group_by() + summarize()
</p>
<p>Commonly used in analysis,<code>summarize()</code> will create
column(s) of summary statistics for each group of rows.</p>
<p>To define the summaries, you can use any aggregate function that
takes a vector of values and returns a single value. Examples:</p>
<div class="indented2">
<p><code>n(), mean(), sum(), median(), min(), max(), first(), last(), sd(), IQR()</code></p>
</div>
<p><br />
</p>
<p><strong>Example: How many category 4 and higher storms were there
each month?</strong></p>
<div class="indented2 indented2r">
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>storms <span class="sc">|&gt;</span>  </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, month, category, hurricane_force_diameter) <span class="sc">|&gt;</span>         <span class="do">## select the columns we need</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">&gt;=</span> <span class="dv">4</span>) <span class="sc">|&gt;</span>                                           <span class="do">## filter those rows where category &gt;= 4</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">|&gt;</span>                                                 <span class="do">## group the rows by month</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">num_hurricanes =</span> <span class="fu">n</span>(),                                    <span class="do">## for each group, report the count</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_diam =</span> <span class="fu">mean</span>(hurricane_force_diameter, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 3
##   month num_hurricanes avg_diam
##   &lt;dbl&gt;          &lt;int&gt;    &lt;dbl&gt;
## 1     7             12     63.6
## 2     8             95     92.9
## 3     9            275     86.7
## 4    10             91     78.2
## 5    11             24     51.9</code></pre>
</div>
<p><br />
</p>
</div>
<div id="notebook-2-cummulative-metrics-and-multi-year-summaries"
class="slide section level1">
<h1>Notebook 2: Cummulative metrics and multi-year summaries</h1>
<div class="shaded-box li-single" style="width:50%;">
<ol style="list-style-type: decimal">
<li>Import 10-years of daily gridMET data from Cal-Adapt</li>
<li>Filter by months and Julian days</li>
<li>Compute degree days</li>
<li>Find the date when a specific cumulative degree day threshold is
reached</li>
<li>Interpolate hourly temperatures</li>
<li>Compute chill portions</li>
</ol>
</div>
<p>Or see the <a href="../agclim_nb02_answers.nb.html" target="_blank"
rel="noopener">Completed Notebook #2</a>.</p>
</div>
<div id="end" class="slide section level1">
<h1>End</h1>
</div>

  <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>

</body>
</html>
